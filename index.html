const businessWA = "+6285399652487";

// Example: codes mapped to WhatsApp numbers (you generate manually)
const validCodes = {
  "UNLOCK001": "+628123456789", // Code for user1 after payment
  "UNLOCK002": "+628987654321", // Code for user2
};

let unlockedModules = JSON.parse(localStorage.getItem('unlockedModules') || "{}");

function lockModule(moduleName, url) {
  if (unlockedModules[moduleName]) {
    window.location.href = url;
    return;
  }

  alert(`The "${moduleName}" module is locked.\n\nTo unlock:  
1️⃣ Contact us on WhatsApp.  
2️⃣ Transfer IDR 200k via OVO to ${businessWA}.  
3️⃣ After we verify your payment, we will send you a unique unlock code.`);

  // Open WhatsApp pre-filled message
  const waMessage = encodeURIComponent(`Hello, I want to unlock the "${moduleName}" nursing test module and I agree to transfer IDR 200k via OVO to ${businessWA}.`);
  window.open(`https://wa.me/${businessWA}?text=${waMessage}`, "_blank");

  // Ask user for WhatsApp number
  const userWA = prompt("Enter your WhatsApp number used to contact us (include country code, e.g., +628123456789):");
  if (!userWA) return alert("No WhatsApp number entered. Module remains locked.");

  // Ask for the unlock code (sent manually by you after checking OVO)
  const code = prompt("Enter the unlock code you received via WhatsApp after payment:");
  if (!code) return alert("No code entered. Module remains locked.");

  // Verify code matches the WhatsApp number
  if (validCodes[code] === userWA) {
    unlockedModules[moduleName] = true;          // unlock for this user
    localStorage.setItem('unlockedModules', JSON.stringify(unlockedModules));
    alert(`✅ "${moduleName}" unlocked! Redirecting now...`);
    delete validCodes[code];                     // prevent reuse
    window.location.href = url;
  } else {
    alert("❌ Invalid code or WhatsApp number. Please contact us to get a valid unlock code.");
  }
}
