<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard - Unlock Codes</title>
<style>
  body { font-family: Arial, sans-serif; background:#f9f9f9; margin:0; padding:20px; }
  h1 { text-align:center; color:#003366; }
  .container { max-width:480px; margin:auto; padding:20px; background:#fff; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1); }
  input, button { width:100%; padding:12px; margin-top:10px; font-size:1rem; border-radius:6px; border:1px solid #ccc; }
  button { background:#003366; color:#fff; border:none; cursor:pointer; }
  button:hover { background:#0055aa; }
  .code-list { margin-top:20px; background:#eee; padding:10px; border-radius:6px; max-height:200px; overflow-y:auto; font-family:monospace; }
</style>
</head>
<body>
<div class="container">
  <h1>Admin Dashboard</h1>
  <p>Click the button to generate a new random unlock code:</p>
  <button onclick="generateCode()">Generate Code</button>

  <p>Existing Codes:</p>
  <div class="code-list" id="codeList">Loading...</div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbw9c1P3M2Mfgeky8Qrjmf80IND5yx5Ur_YLWiT2xhvo0WglKVT5OQbLfn0JuvdNwTSG/exec";

// Fetch existing codes and display
async function fetchCodes() {
  try {
    const response = await fetch(API_URL);
    const data = await response.json();
    const codes = data.codes || [];
    document.getElementById('codeList').textContent = codes.join('\n');
    return codes;
  } catch(err) {
    console.error(err);
    document.getElementById('codeList').textContent = 'Error fetching codes.';
    return [];
  }
}

// Generate a random 6-digit alphanumeric code
function randomCode(length = 6) {
  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
  let code = '';
  for(let i=0;i<length;i++) {
    code += chars.charAt(Math.floor(Math.random()*chars.length));
  }
  return code;
}

// Generate code and update backend
async function generateCode() {
  const existingCodes = await fetchCodes();
  const newCode = randomCode();
  existingCodes.push(newCode);

  // Update codes.json in GitHub via Apps Script
  try {
    const response = await fetch(API_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ codes: existingCodes })
    });
    const result = await response.json();
    alert(`New code generated: ${newCode}`);
    await fetchCodes(); // refresh list
  } catch(err) {
    console.error(err);
    alert('Failed to update codes. Check Apps Script deployment.');
  }
}

// Initial fetch
fetchCodes();
</script>
</body>
</html>
